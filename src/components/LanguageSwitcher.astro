---
---

<div class="language-switcher">
  <button class="lang-btn active" data-lang="es" title="EspaÃ±ol">
    <span class="flag">ðŸ‡¨ðŸ‡´</span>
  </button>
  <button class="lang-btn" data-lang="en" title="English">
    <span class="flag">ðŸ‡¬ðŸ‡§</span>
  </button>
  <button class="lang-btn" data-lang="de" title="Deutsch">
    <span class="flag">ðŸ‡©ðŸ‡ª</span>
  </button>
</div>

<style>
  .language-switcher {
    position: fixed;
    top: 1rem;
    left: 1rem;
    display: flex;
    gap: 0.5rem;
    z-index: 1000;
    background: rgba(0, 0, 0, 0.9);
    padding: 0.5rem;
    border-radius: 8px;
    border: 1px solid var(--color-matrix-primary);
    backdrop-filter: blur(5px);
    width: 3.5rem; /* Start with a fixed width */
    height: 3.5rem;
    overflow: hidden; /* Important to hide the non-active buttons */
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); /* Animate width */
    justify-content: flex-start; /* Always start from the left */
    align-items: center;
  }

  .language-switcher:hover {
    width: 9.5rem; /* Fixed width on hover */
  }

  .lang-btn {
    background: transparent;
    border: none; /* Removed border */
    border-radius: 4px;
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    font-size: 1.5rem;
    flex-shrink: 0;
    transition: all 0.3s ease;
    position: relative;
  }

  /* Hide non-active buttons by default */
  .lang-btn:not(.active) {
    opacity: 0;
    pointer-events: none;
    transform: scale(0.8);
    width: 0; /* Collapse the width */
    padding: 0; /* Remove padding when hidden */
    transition: opacity 0.3s ease, transform 0.3s ease, width 0.3s ease, padding 0.3s ease;
  }

  /* Position inactive buttons when expanded */
  .language-switcher:hover .lang-btn:not(.active) {
    opacity: 1;
    pointer-events: auto;
    transform: scale(1);
    width: auto; /* Restore width */
    padding: 0.25rem 0.5rem; /* Restore padding */
  }

  .lang-btn:hover {
    /* border-color removed */
    transform: scale(1.1);
  }

  .lang-btn.active {
    /* border-color removed */
    /* box-shadow removed as requested */
    opacity: 1;
  }

  .flag {
    display: block;
    filter: grayscale(0.3);
    transition: filter 0.3s ease;
  }

  .lang-btn:hover .flag,
  .lang-btn.active .flag {
    filter: grayscale(0);
  }
</style>

<script>
  import { languages, defaultLang, type Language } from '../i18n';

  // Get current language from localStorage or use default
  let currentLang: Language = (localStorage.getItem('language') as Language) || defaultLang;

  // Set active button on load
  document.addEventListener('DOMContentLoaded', () => {
    updateActiveButton();
    updatePageContent();
  });

  // Add click listeners to language buttons
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.getAttribute('data-lang') as Language;
      if (lang && lang in languages) {
        currentLang = lang;
        localStorage.setItem('language', lang);
        updateActiveButton();
        updatePageContent();
      }
    });
  });

  function updateActiveButton() {
    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.classList.remove('active');
      if (btn.getAttribute('data-lang') === currentLang) {
        btn.classList.add('active');
      }
    });
  }

  function updatePageContent() {
    const t = languages[currentLang];
    
    // Update HTML lang attribute
    document.documentElement.lang = currentLang;

    // Dispatch custom event for components to update
    window.dispatchEvent(new CustomEvent('languageChanged', { 
      detail: { lang: currentLang, translations: t } 
    }));
  }
</script>
